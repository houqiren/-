# DNS 域名解析服务器

nmcli connection   修改IP命令
nmcli connection delete ens33  删除原有网卡文件
nmcli connection add type ethernet ifname ens33 con-name ens33  添加网卡文件
nmcli connection modify ens33 ipv4.addresses 192.168.1.30/24  添加IP和子网掩码
nmcli connection modify ens33 ipv4.gateway 192.168.1.254  添加网关
nmcli connection modify ens33 ipv4.method manual   使文件生效
systemctl stop  NetworkManager  停止网卡进程

删除原有网卡，新建一个网卡
dhclient -d   获取地址


cd /etc/yum.repos.d/
mkdir data
mv C* /etc/yum.repos.d/data/
vim local.repo

[local]
name=local
baseurl=file:///cdrom
enabled=1
gpgcheck=0
         
cd
mkdir /cdrom
mount /dev/sr0 /cdrom

------------------------------------------------------------------------------------
DNS 域名解析服务器
域名 www.baidu.com
hosts 本地 不太安全
NIS  可以将hosts和passwd进行绑定
FQDN 完整的限定域名 www.baidu.com.

DNS的查询原理  迭代查询
本地 ---ldns(网络供应商)---一级域名（.com.org.edu）---二级域名---三级域名（13个）

dns相当于网络上的地址数据库，里面存放着IP和域名

自己搭建DNS
 主域名解析服务器  从域名解析服务器  缓存域名解析服务器
bind          支持多平台 centos7 版本：bind-9 里面存放的是程序和相关的文件
bind-utils    存放的是dns的测试文件
bind-chroot   可以伪装根目录
检测dns是否安装成功    nslookup   dig
bind主配置文件路径 
  /etc/named.conf
bind区域配置文件
  /etc/named/rfc1912.zones
数据库文件 
  /var/named
数据库文件中的 记录类型 
TTL   缓存时间
SOA   起始授权记录
NS    域名
A     对应ipv4地址
PTR   用于反向解析
CNAME 记录别名
MX    记录邮件
AAAA  ipv6地址

# DNS主域名解析服务器

1.安装bind
mkdir /cdrom
mount /dev/sr0 /cdrom
cd /cdrom/Packages
rpm -ivh bind-9.9.4-72.el7.x86_64.rpm 
rpm -qa | grep bind （检查是否安装成功）
修改主配置文件
vim /etc/named.conf
listen-on port 53 { 127.0.0.1; }; --- listen-on port 53 { any; }; #监听端口的配置
allow-query     { localhost; };   --- allow-query     { any; }; #对于客户端的配置 允许所有的
#include "/etc/named.root.key";  #此行注释 最后一行
修改区域配置文件
zone "kgc.com" IN{
        type master;  #类型
        file "kgc.com.zone"; #数据库文件的名称
        allow-transfer{192.168.1.100;};  #从服务器的ip
        allow-update{none;};  #不允许更新
};
zone "1.168.192.in-addr.arpa" IN{
        type master;
        file "192.168.1.arpa";

};
修改数据库文件
[root@centosD named]# cp -p named.localhost kgc.com.zone
[root@centosD named]# cp -p named.localhost 192.168.1.arpa
vim /var/named/kgc.com.zone
$TTL 1D
@	IN SOA	kgc.com. root.kgc.com. (
					2019111901	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
	NS	@
	A	127.0.0.1
	AAAA	::1
www	A	192.168.1.3
qqq	CNAME	www

$TTL 1D  #有效地址的缓存记录时间
@	代表本机
kgc.com. 域名 
 root.kgc.com. 管理员邮箱
2019111901	（序列号10位）; serial
1D	; refresh  刷新时间  针对从
1H	; retry  重试时间  如果在更新地址数据库失败 多久后重试
1W	; expire  失效时间  如果超过这个时间仍然不能更新 就停止尝试
3H )	; minimum  无效地址的缓存时间
NS	@  NS代表域名服务器的记录 @代表继承了SOA里面的数据
A	127.0.0.1
AAAA	::1
www	A	192.168.1.3  解析时间
qqq	CNAME	www

反向解析文件
$TTL 1D
@	IN SOA	kgc.com. root.kgc.com. (
					2019111901	; serial
					1D	; refresh
					1H	; retry
					1W	; expire
					3H )	; minimum
	NS	@
	A	127.0.0.1
	AAAA	::1
3	PTR	www.kgc.com.

检测配置文件
named-checkconf /etc/named.conf
named-checkconf /etc/named/rfc1912.zones
named-checkzone kgc.com kgc.com.zone
named-checkzone kgc.com 192.168.1.arpa

vim /etc/reslov.conf  指定DNS

Generated by NetworkManager

nameserver 192.168.2.10



scp /etc/yum.repos.d/C* root@192.168.1.3:/etc/yum.repos.d

# 从域名解析服务器

安装bind
mkdir /cdrom
mount /dev/sr0 /cdrom
cd /dev/Packages
rpm -ivh bind-9.9.4-72.el7.x86_64.rpm 

vim /etc/named.conf
  listen-on port 53 { 127.0.0.1; }; --- listen-on port 53 { any; }; #监听端口的配置
  allow-query     { localhost; };   --- allow-query     { any; }; #对于客户端的配置 允许所有的
  #include "/etc/named.root.key";  #此行注释 最后一行

vim /etc/named.rfc1912.zones

  zone "kgc.com" IN{
        type slave;
        masters {192.168.1.3;};
        file "slaves/kgc.com.zone";
  };
  zone "1.168.192.in-addr.arpa" IN {
        type slave;
        masters {192.168.1.3;};
        file "slaves/192.168.2.arpa";
  };

# WEB服务

  apache（httpd）
    1、很多的大公司都在使用Apache，它比较稳定
    2、开源软件
    3、支持很多的模块
    4、对于公司而言，可以用来做二次开发
    5、能够更加兼容动态页面
  基于http协议
  ./configure 
  --prefix=/usr/local/httpd #指定安装的路径
  --enable-so 				#支持动态模块的加载机制
  --enable-ssl 				#支持ssl
  --enable-cgi 				#激活CGI
  --enable-rewrite 			#支持地址重写
  --with-pcre 				#在url地址重写的时候会用 正则表达式库
  --enable-modules=most 	#编译进去大部分模块 all代表所有
  --enable-mpms-shared=all 	#把支持mpm的模块都编译进来
  --with-mpm-prefork  		#把mpm的模块编译进来以后，默认使用prefork

###   安装apache

​     1、rpm -qa | grep httpd）#检测是否安装 httpd
​	    rpm -evh httpd #卸载
​		yum -y install pcre pcre-devel #安装依赖关系
​		yum -y install openssl-devel apr* #安装依赖关系
​		tar -zxf httpd-2.4.25.tar.gz #解压httpd源码包 -C 指定解压位置
​		cd httpd-2.4.25/ #进入解压目录
​		./configure --prefix=/usr/local/httpd --enable-so --enable-ssl --enable-cgi --enable-rewrite --with-pcre --enable-modules=most --enable-mpms-shared=all --with-mpm-prefork  #配置
​		make && make install  #编译 安装
​		cd /usr/local/httpd/  #切换到安装目录
​		cd bin  #切换目录
​		cp apachectl /etc/rc.d/init.d/httpd  #httpd服务文件到 系统服务文件
​		ls /etc/rc.d/init.d/  #查看是否复制过去
​		vim /etc/rc.d/init.d/httpd
​			#chkconfig:2345 96 36  #添加
​		chkconfig --add httpd  #添加到服务
​		systemctl start  httpd #启动服务
​		curl 127.0.0.1  #检测能不能访问到页面
​		#页面文件存放在 htdocs 
​		配置文件路径：vim /usr/local/httpd/conf/httpd.conf

### 主要配置文件解释

​        ServerRoot "/usr/local/httpd" #根路径  也就是所谓的安装路径
​		Listen 80  #监听端口
​		Pidfile  #指定pid文件的路径
​		LoadModule autoindex_module modules/mod_autoindex.so   			#代表加载动态模块文件  如果要php结合 需要加载php.so的文件
   	 	172 User daemon  #用户
​		173 Group daemon #组
​		194 ServerAdmin you@example.com  #管理员邮箱
​		203 #ServerName www.example.com:80 #域名 
​		210 <Directory />  #页面访问的属性
​		211 AllowOverride none  #.htaccess完全忽略 all不忽略
​		212 Require all denied  # 拒绝所有的访问
​					gtanted	# 允许访问
​		241 Options Indexes FollowSymLinks 
​			Indexes   #缺少指定的默认页面 将会以目录的形式现实
​			FollowSymLinks   #是否将符号链接指向文件打开
​		213 </Directory>
​		227 DocumentRoot "/usr/local/httpd/htdocs" #站点根目录
​		260 <IfModule dir_module>
​		261    DirectoryIndex index.html  默认索引页
​		262 </IfModule>
​		279 ErrorLog "logs/error_log"  #定义错误日志
​		286 LogLevel warn  #等级 ERROR WARN INFO DEBUG 高---低
​		308 CustomLog "logs/access_log" common  #定义日志的文件名和格式 

# 虚拟主机

netstat -anput |grep httpd  #检测有关httpd的端口

![](F:\图片\d (1) 0.png)

###  基于域名的虚拟主机

  vim /etc/hosts
    192.168.1.11 www.benet.com
    192.168.1.11 www.accp.com
  vim /usr/local/httpd/conf/httpd.conf
    #最后一行添加
	cd ../htdocs/
	mkdir benet
    mkdir accp
	echo "<h1>benet</h1>" >> benet/index.html
	echo "<h1>accp</h1>" >> accp/index.html

```配置文件
<VirtualHost 192.168.1.11>
    DocumentRoot /usr/local/httpd/htdocs/benet
    ServerName www.benet.com
</VirtualHost>
<VirtualHost 192.168.1.11>
    DocumentRoot /usr/local/httpd/htdocs/accp
    ServerName www.accp.com
</VirtualHost>
```
 systemcl restart httpd

![](F:\图片\a 0.png)

### 基于端口

​	vim httpd
​	Listen 8080
​	<VirtualHost 192.168.1.11:80>
​        DocumentRoot /usr/local/httpd/htdocs/benet
​        ServerName www.benet.com
​	</VirtualHost>
​	<VirtualHost 192.168.1.11:8080>
​        DocumentRoot /usr/local/httpd/htdocs/accp
​        ServerName www.accp.com
​	</VirtualHost>
​	systemctl restart httpd
​	curl 192.168.1.11:80
​	curl 192.168.1.11:8080

![](F:\图片\b 0.png)

###  基于IP

​    ifconfig ens33:0 192.168.1.12
​	vim httpd
​	<VirtualHost 192.168.1.11>
​        DocumentRoot /usr/local/httpd/htdocs/benet
​        ServerName www.benet.com
​	</VirtualHost>
​	<VirtualHost 192.168.1.12>
​        DocumentRoot /usr/local/httpd/htdocs/accp
​        ServerName www.accp.com
​	</VirtualHost>
​	systemctl restart httpd

![](F:\图片\c 0.png)